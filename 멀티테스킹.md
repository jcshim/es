# 아두이노에서 멀티태스킹을 구현하는 5가지 핵심 기법

## 1. `millis()`로 논블로킹 코드 만들기

* **아이디어**: `delay()`를 쓰지 않고, `millis()`로 시간이 얼마나 지났는지만 보고 “해야 할 일”을 나눠서 처리.
* **느낌**: 여러 일이 *조금씩 번갈아* 실행되면서 동시에 돌아가는 것처럼 보임.
* **예시**:

  * LED 깜빡이기는 500ms마다
  * 센서 읽기는 100ms마다
  * 시리얼 출력은 1초마다
    → 각각 “마지막 실행 시간”을 저장해 두고, `if (millis() - 이전시간 >= 간격)`이면 그때만 실행.

---

## 2. MsTimer2 같은 **타이머 인터럽트 라이브러리** 사용

* **아이디어**: 내부 타이머가 일정 시간마다 “벨을 울려서” 함수를 한번 불러줌(인터럽트).
* **느낌**: 메인 `loop()`는 다른 일을 하고 있는데도, 타이머가 주기적으로 끼어들어 일을 하는 구조.
* **예시**:

  * MsTimer2로 1ms마다 `timerISR()` 실행 → 그 안에서 카운터 증가, 주기적인 작업 플래그 세팅.

> ISR 안에서는 짧게만 처리하고, 실제 긴 작업은 `loop()`에서 플래그 보고 처리하는 식이 안전합니다.

---

## 3. **스케줄러 라이브러리** 사용 (SimpleTimer, TaskScheduler 등)

* **아이디어**: 여러 “작업(task)”을 등록해 놓고, 각 작업의 **주기**를 정해주면 라이브러리가 알아서 시간 보고 호출.
* `loop()` 안에서는 `scheduler.run();` 같은 한 줄만 계속 돌려도 됨.
* **느낌**: 작은 OS 스케줄러처럼, 여러 함수가 각자 주기대로 돌아감.
* **예시**:

  * `timer.setInterval(100, readSensor);`
  * `timer.setInterval(500, blinkLed);`
  * `timer.setInterval(1000, printSerial);`

---

## 4. **상태 머신(State Machine) 구조로 나누기**

* **아이디어**: 한 기능을 “여러 단계(상태)”로 나누고, 매번 한 단계씩만 조금 처리하고 다시 `loop()`로 돌아오기.
* **느낌**: 한 함수가 오래 점유하지 않으니, 여러 기능이 번갈아 한 입씩 먹는 식으로 실행 → 멀티태스킹 비슷.
* **예시** (LED 예):

  * 상태: `OFF`, `ON`, `BLINK`
  * `loop()`에서 현재 상태에 따라 조그마한 작업만 하고 바로 리턴
  * 상태 전환 시점은 `millis()`로 시간 체크.

---

## 5. **ProtoThreads / 코루틴 스타일 라이브러리 사용**

* **아이디어**: “스레드처럼” 보이는 코드를 짤 수 있도록 도와주는 아주 가벼운 라이브러리.
* **특징**:

  * 함수 안에서 `wait(1000);` 같은 식으로 쓰지만, 실제로는 `delay()`처럼 막히지 않고 다른 작업이 그 사이에 실행됨.
  * 여러 개의 프로토스레드(프로토스레드 함수)를 등록해 두고 번갈아 실행.
* **느낌**: 진짜 스레드는 아니지만, 코드 모양은 **동기/순차**처럼 보이고, 동작은 **협력적 멀티태스킹**.

---

### 한 번에 정리하면

1. `millis()`로 직접 시간 관리 (기본기, 꼭 익혀야 하는 패턴)
2. MsTimer2 같은 타이머 인터럽트 (정확한 주기 작업)
3. SimpleTimer / TaskScheduler 같은 스케줄러 라이브러리 (여러 주기 작업 관리)
4. 상태 머신으로 기능을 잘게 쪼개기 (구조화 + 멀티스텝 동작)
5. ProtoThreads/코루틴 스타일 라이브러리 (코드는 단순, 동작은 멀티태스킹 느낌)
